<!DOCTYPE html>
<html>
	<head>
		<title> NPC </title>
		<meta charset="utf-8">
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport" />
		<script src="Scripts/jquery-1.8.2.min.js"></script>
		<script src="Scripts/common.js"></script>
		<script src="Scripts/shCore.js"></script>
		<script src="Scripts/NZ-MsgBox.min.js"></script>
		<script src="Scripts/multiselect.js"></script>
		<!-- http://www.bootstrapmb.com/item/7403/preview -->
		<link rel="stylesheet" type="text/css" href="css/iconfont.css"/>
		<link rel="stylesheet" type="text/css" href="css/multiselect.css"/>		
		<link href="css/NZ-MsgBox.min.css" rel="stylesheet" />
		<style type="text/css">
			p {
				width: 95%;
				margin: 0 auto;
				/*p相对屏幕左右居中*/
				padding-bottom: 10px;
			}
			.tableSort {
				border: solid 1px #666;
				border-collapse: collapse;
				width: 100%;
				cursor: default;
			}
			.tableSort tr {
				border: solid 1px #666;
				height: 30px;
			}
			table thead tr {
				background-color: #ccc;
				font-size: 111%;
			}
			.tableSort td {
				border: solid 1px #666;
				text-align: center;
			}
			.tableSort th {
				border: solid 1px #666;
				text-align: center;
				cursor: pointer;
			}
			
			input {
				font-size: 99%;
				border: 0px;
				width: 98%;
				text-align: center;
				/* background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, pink); /* linear rainbow */ */
			}
			
			input[type="text"]:focus {  //获取焦点时边框发光
				transition: border linear .2s, box-shadow linear .5s;
				-moz-transition: border linear .2s, -moz-box-shadow linear .5s;
				-webkit-transition: border linear .2s, -webkit-box-shadow linear .5s;
				outline: none;
				border-color: rgba(93,149,242,.75);
				box-shadow: 0 0 8px rgba(93,149,242,.105);
				-moz-box-shadow: 0 0 8px rgba(93,149,242,.5);
				-webkit-box-shadow: 0 0 8px rgba(93,149,242,3);
				background: #33ffff;
			}
			
			button {
				border-radius: 30px;
			}
			
			button:hover {
				background-color: green;
			}
			
			* {
				-webkit-touch-callout: none;  /*系统默认菜单被禁用*/
				-webkit-user-select: none;  /*webkit浏览器*/
				-khtml-user-select: none;  /*早起浏览器*/
				-moz-user-select: none;  /*火狐浏览器*/
				-ms-user-select: none;  /*IE浏览器*/
				user-select: none;  /*用户是否能够选中文本*/
			}
		</style>
		<style>
			/* Switch开关样式 */
			input[type='checkbox'].switch {
				outline: none;
				appearance: none;
				-webkit-appearance: none;
				-moz-appearance: none;
				position: relative;
				width: 80px;
				height: 60px;
				background: #ccc;
				border-radius: 10px;
				transition: border-color .3s, background-color .3s;
			}

			input[type='checkbox'].switch::after {
				content: '';
				display: inline-block;
				width: 1.5rem;
				height: 1.5rem;
				border-radius: 50%;
				background: #fff;
				box-shadow: 0, 0, 2px, #999;
				transition: .4s;
				top: 9px;
				position: absolute;
				left: 10px;
			}

			input[type='checkbox'].switch:checked {
				background: rgb(19, 206, 102);
			}

			/* 当input[type=checkbox]被选中时：伪元素显示下面样式 位置发生变化 */
			input[type='checkbox'].switch:checked::after {
				content: '';
				position: absolute;
				left: 60%;
				top: 9px;
			}
		</style>
		<style>
			li:nth-child(1) {
				color: #EE0000;
			}
			li:nth-child(2) {
				color: #EE3B3B;
			}
			li:nth-child(3) {
				color: #EE7621;
			}
			li:nth-child(4) {
				color: #EEA2AD;
			}
			li:nth-child(5) {
				color: #5CACEE;
			}
			li:nth-child(6) {
				color: #6495ED;
			}
			li:nth-child(7) {
				color: #4169E1;
			}
			li:nth-child(8) {
				color: #0000EE;
			}
			li {
				font-size: 32px;
			}
			.selectList {
				height: 40px;
				overflow-y: auto;
			}
		</style>
		<style>
			<!-- input { -->
				<!-- color: #FF0000; -->
				<!-- animation: bgColor 5s infinite linear; -->
			<!-- } -->
			<!-- @keyframes bgColor { -->
				<!-- 12.5% { color: #FF0000; } -->
				<!-- 25% { color: #FFA500; } -->
				<!-- 37.5% { color: #FFFF00; } -->
				<!-- 50% { color: #7FFF00; } -->
				<!-- 62.5% { color: #00FFFF; } -->
				<!-- 75% { color: #0000FF; } -->
				<!-- 87.5% { color: #9932CC; } -->
				<!-- 100% { color: #FF1493; } -->
			<!-- } -->
		</style>
	</head>
	<body>
	    <input id="KillInfo" type="hidden" value="" />
	    <table border="0" width="100%">
		    <tr>
			    <td align="center">
					<table id="tableSort" class="tableSort" style="width: 99%">
						<thead>
							<tr>
								<th type="number">序号</th>
								<th type="string">姓名</th>
								<th type="string">时间1</th>
								<th type="string">时间2</th>
								<th type="string">装备</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</td>
			</tr>
		</table>
		<div id="blankDiv"></div>
		<div style="position: fixed; bottom: 5px; width: 99%; background-color: rgba(0, 0, 0, 0.1); backdrop-filter: blur(5px);">
			<table style="width: 99%" align="center">
				<tbody>
					<tr>
						<td colspan="3" align="right">
							<table>
								<tr>
									<td>
										<button style="width: 120px" onclick="SetTopNPC()">置顶</button>
									</td>
									<td style="width:10px"></td>
									<td>
										<button style="width: 120px" onclick="MergeNPC()">合并</button>
									</td>
									<td style="width:10px"></td>
									<td style="display:none; vertical-align:middle; font-size: small">排序规则</td>
									<td>
										<select style="height: 42px; font-size: 1.2rem; background: #ccc; border-radius: 10px;" id="orderIndex">
											<option value="0">默认排序</option>
											<option value="1">按姓名排序</option>
											<option value="2">按职业排序</option>
											<option value="3">按出装几率排序</option>
											<option value="4">按装备质量排序</option>
										</select>
									</td>
									<td style="width:10px"></td>
									<td style="display:none; vertical-align:middle; font-size:small">自动当前时间</td>
									<td>
										<input type="checkbox" checked class="switch" id="ckCurrTime" title="自动当前时间已开启" onchange="ShowCurrentTime(this)">
									</td>
									<td style="width:10px"></td>
									<td style="display:none; vertical-align:middle; font-size:small">自动调整时间</td>
									<td>
										<input type="checkbox" checked class="switch" id="ckTime" title="自动调整时间已开启" onchange="ShowTime(this)">
									</td>
									<td style="width:10px"></td>
									<td style="display:none; vertical-align:middle; font-size:small">消息提示</td>
									<td>
										<input type="checkbox" class="switch" id="ckMessage" title="消息提示已关闭" onchange="ShowTitle(this)">
									</td>
									<td style="width:10px"></td>
									<td style="display:none; vertical-align:middle; font-size:small">切换排序角色</td>
									<td>
										<input type="checkbox" class="switch" id="ckChangePlayer" title="当前角色：制杖老魔" onchange="ChangePlayer(this)">
									</td>
								</tr>
							</table>
						</td>
					</tr>
					<tr>
						<td colspan="3" align="center">
							<table style="width: 100%">
								<tr>
									<td style="width: 25%">
										<button style="width:99%" onclick="SetTime(1)">+60(出装)</button>
									</td>
									<td style="width: 25%">
										<button style="width:99%" onclick="SetTime(2)">+60</button>
									</td>
									<td align="center" style="width: 25%">
										<button style="width:99%" onclick="SetTime(3)">+30</button>
									</td>
									<td align="center" style="width: 25%; display: none">
										<button style="width:99%" onclick="SetTime(4)">+1</button>
									</td>
								</tr>
							</table>
						</td>
					</tr>
					<tr>
						<td colspan="3" align="center">
							<table style="width: 100%">
								<tr>
									<td style="width: 25%">
										<button style="width:99%" onclick="SetTime(11)">-60(出装)</button>
									</td>
									<td style="width: 25%">
										<button style="width:99%" onclick="SetTime(22)">-60</button>
									</td>
									<td align="center" style="width: 25%">
										<button style="width:99%" onclick="SetTime(33)">-30</button>
									</td>
									<td align="center" style="width: 25%; display: none">
										<button style="width:99%" onclick="SetTime(44)">-1</button>
									</td>
								</tr>
							</table>
						</td>
					</tr>
					<tr>
						<td style="width: 40%" align="center">
							<table style="width: 100%">
								<tr>
									<td>
										<button style="width:99%" onclick="Copy1()">复制(NPC)</button>
									</td>
									<td>
										<button style="width:99%" onclick="Copy2()">复制(参数)</button>
									</td>
								</tr>
							</table>
						</td>
						<td style="width: 40%" align="center">
							<table style="width: 100%">
								<tr>
									<td>
										<button style="width:99%" onclick="Paste1()">粘贴(NPC)</button>
									</td>
									<td>
										<button style="width:99%" onclick="Paste2()">粘贴(参数)</button>
									</td>
								</tr>
							</table>
						</td>
						<td style="width: 20%" align="center">
							<button style="width:99%" onclick="Sort()">刷新</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="divProgress" class="divProgress" style="text-align: center; display: none; position: fixed; width: 880px; height: 300px; border: 1px dashed #000; border-radius: 10px; box-shadow: 10px 10px 5px 0px rgba(0, 0, 0, 0.3); background-color: #99cccc">
			<div id="Equip00" style="width: 99%; font-size: 400%; padding-top: 10px"></div>
			<input type="text" id="EquipValue00" style="display: none" />
			<table style="padding-top: 120px; padding-right: 10px; width: 100%">
				<tr>
					<td></td>
					<td style="width: 150px">
						<button style="width: 150px" onclick="HideProgressBar()">关闭</button>
					</td>
					<td style="width: 150px; padding-left: 5px">
						<button style="width: 150px" onclick="SaveData()">确定</button>
					</td>
				</tr>
			</table>
		</div>
		<div id="divMaskFrame" style="background-color: #F2F4F7; display: none; left: 0px; position: absolute; top: 0px;"></div>

		<style>
			@keyframes ball {
				0% { opacity: 0; }
				25% { opacity: 0.4; }
				50% { opacity: 0.7; }
				75% { opacity: 0.9; }
				100% { opacity: 1; }
			}
			.divProgress {
				opacity: 1;
				animation-name: ball;
				animation-duration: 2s;
				animation-play-state: paused;
			}
		</style>

		<script type="text/javascript">
			var TotalRowCount = 100;
			var SelectIndex = "01";  //选中的“行”
			var MessageTimer;  //“提示”计时器
			var ColorTimer;  //“颜色”计时器
			var TotalCount = 2;  //總數據條數\head占一行

			window.onload = function() {
				var tb = document.getElementById("tableSort");
				for(var i=1; i<=TotalRowCount; i++) {
					var newTr = tb.insertRow(i);
					var newTd1 = newTr.insertCell();
					newTd1.style = "text-align: center; width: 120px; background: white;";
					newTd1.innerHTML = i;
					
					var newTd2 = newTr.insertCell();
					newTd2.style="width: 300px; background: white;";
					newTd2.innerHTML = "<input id='name" + styleNum(i) + "' type='text' value='' />";
					
					var newTd31 = newTr.insertCell();
					newTd31.style="width: 130px; background: white;";
					newTd31.innerHTML = "<input id='date" + styleNum(i) + "' type='hidden' value='' /><input id='time" + styleNum(i) + "' type='text' value='' readonly />";
					
					var newTd32 = newTr.insertCell();
					newTd32.style="width: 130px; background: white;";
					newTd32.innerHTML = "<input id='date2" + styleNum(i) + "' type='hidden' value='' /><input id='time2" + styleNum(i) + "' type='text' value='' readonly />";
					
					var newTd4 = newTr.insertCell();
					newTd4.style="text-align: center; background: white;";
					newTd4.innerHTML = "<div id='Equip" + styleNum(i) + "' style='width: 99%; font-size: 14px'></div><input type='text' id='EquipValue" + styleNum(i) + "' style='display: none' />";
				}
				LoadData();
			}
			
			function styleNum(i) {
				if(i<10)
					return '0'+i;
				else
					return i;
			}
		</script>
		
		<script type="text/javascript">
			// 顯示讀取遮罩
			function ShowProgressBar() {
				displayMaskFrame();
			}
			// 隱藏讀取遮罩
			function HideProgressBar() {
				var progress = $('#divProgress');
				var maskFrame = $("#divMaskFrame");
				<!-- progress.hide('slow', 'linear', function() { maskFrame.hide(); }); -->
				progress.hide();
				maskFrame.hide();
				$(".divProgress").each(function(){
					$(this)[0].style["animationPlayState"] = "paused";
				});
			}
			// 顯示讀取畫面
			function displayProgress() {
				var w = $(document).width();
				var h = $(window).height();
				var progress = $('#divProgress');
				progress.css({ "z-index": 999999, "top": (h / 2) - (progress.height() / 2), "left": (w / 2) - (progress.width() / 2) });
				<!-- progress.show('slow', 'linear'); -->
				progress.show();
				$(".divProgress").each(function(){
					$(this)[0].style["animationPlayState"] = "running";
				});
			}
			// 顯示遮罩畫面
			function displayMaskFrame() {
				var w = $(window).width();
				var h = $(document).height();
				var maskFrame = $("#divMaskFrame");
				maskFrame.css({ "z-index": 999998, "opacity": 0.9, "width": w, "height": h });
				<!-- maskFrame.show('fase', 'linear', function() { displayProgress(); }); -->
				maskFrame.show();
				displayProgress();
			}
			
			function SaveData() {
				var selectValue = document.getElementById("EquipValue00").value;
				if(selectValue.length == 0) selectValue = "0";
				var selectDataS = selectValue.split(",");
				var id = "Equip" + SelectIndex;
				let SelectData = {};
				for(var i=0; i<selectDataS.length; i++){
					SelectData[i] = {"colId":selectDataS[i], "colValue":""};
				}
				$("#" + id).multiselectInit({
					"selectData": InitEquip,
					"isSelectData": SelectData,
					"isMulti": true, //是否多选
					"inputId": "EquipValue" + SelectIndex, //输入框的id
					"checkStyle": "fg" //选择的样式
				});
				SetColorState(SelectIndex);
				HideProgressBar();
				Save();
			}
		</script>

		<script type="text/javascript">
			var InitEquip = [
					{"colId":1, "colValue":"武器"},
					{"colId":2, "colValue":"衣服"},
					{"colId":3, "colValue":"头盔"},
					{"colId":4, "colValue":"项链"},
					{"colId":5, "colValue":"左镯"},
					{"colId":6, "colValue":"右镯"},
					{"colId":7, "colValue":"左戒"},
					{"colId":8, "colValue":"右戒"}
				];
			<!-- var oDiv = document.getElementsByTagName("div"); -->
			<!-- for(var i=0; i<oDiv.length; i++) { -->
				<!-- var id = oDiv[i].id; -->
				<!-- if(id.length == 7) { -->
					<!-- if(id.substr(0, 5) == "Equip") { -->
						<!-- var index = oDiv[i].id.substr(5, 2); -->
						<!-- $("#" + id).multiselectInit({ -->
							<!-- "selectData": InitEquip, -->
							<!-- "isMulti": true, //是否多选 -->
							<!-- "inputId": "EquipValue" + index, //输入框的id -->
							<!-- "checkStyle": "fg" //选择的样式 -->
						<!-- }); -->
					<!-- } -->
				<!-- } -->
			<!-- } -->
		</script>
			
		<script type="text/javascript">
			function LoadData() {
				$("input[type='text']").οncοntextmenu = function(e){
					e.preventDefault();
				};

				//打开页面读取数据
				var Info = localStorage.getItem("Info");
				if(Info == null || Info == "") { }
				else {
					var infoS = Info.split(";");
					TotalCount = infoS.length + 2;
					var row = 1;
					while(row <= infoS.length) {
						var s = infoS[row-1].split(" ");
						document.getElementById("name" + (row > 9 ? row : ("0" + row))).value = s[0];
						document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.background = s[3];
						document.getElementById("date" + (row > 9 ? row : ("0" + row))).value = s[1];
						document.getElementById("time" + (row > 9 ? row : ("0" + row))).value = s[2];
						document.getElementById("date2" + (row > 9 ? row : ("0" + row))).value = s[1];
						document.getElementById("time2" + (row > 9 ? row : ("0" + row))).value = s[5];
						document.getElementById("Equip" + (row > 9 ? row : ("0" + row))).style.display = "";
						var selectDataS = s[4].split(",");
						var id = "Equip" + (row > 9 ? row : ("0" + row));
						let SelectData = {};
						for(var i=0; i<selectDataS.length; i++){
							SelectData[i] = {"colId":selectDataS[i], "colValue":""};
						}
						$("#" + id).multiselectInit({
							"selectData": InitEquip,
							"isSelectData": SelectData,
							"isMulti": true, //是否多选
							"inputId": "EquipValue" + (row > 9 ? row : ("0" + row)), //输入框的id
							"checkStyle": "fg" //选择的样式
						});
						SetColorState(row > 9 ? row : ("0" + row));
						row++;
					}
					while(row <= TotalRowCount) {
						document.getElementById("name" + (row > 9 ? row : ("0" + row))).value = "";
						document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.background = "white";
						document.getElementById("date" + (row > 9 ? row : ("0" + row))).value = "";
						document.getElementById("time" + (row > 9 ? row : ("0" + row))).value = "";
						document.getElementById("date2" + (row > 9 ? row : ("0" + row))).value = "";
						document.getElementById("time2" + (row > 9 ? row : ("0" + row))).value = "";
						document.getElementById("Equip" + (row > 9 ? row : ("0" + row))).style.display = "none";
						document.getElementById("EquipValue" + (row > 9 ? row : ("0" + row))).value = "";  //清空、否则新建的时候会错误用到
						row += 1;
					}
					for(var ii = TotalCount; ii<=TotalRowCount; ii++) {
						rowOutIn(ii, "close");
					}
					MessageTimer = self.setInterval("notifyMe()", 60000);
					ColorTimer = self.setInterval("colorMe()", 1000);
				}
				document.getElementById("KillInfo").value = localStorage.getItem("KillInfo");
				//获取选中行
				$("input[type='text']").focus(function () {
					var id = $(this)[0].id;
					SelectIndex = id.substr(4);
				});
				$("input[type='text']").dblclick(function (e) {
					var id = $(this)[0].id;
					if(id.substr(0,4) == "time") {
						var d = new Date();
						var y1 = d.getFullYear();
						var m1 = d.getMonth() + 1;
						m1 = m1 > 9 ? m1 : ("0" + m1);
						var d1 = d.getDate();
						d1 = d1 > 9 ? d1 : ("0" + d1);
						var h = d.getHours();
						h = h > 9 ? h : ("0" + h);
						var m = d.getMinutes();
						m = m > 9 ? m : ("0" + m);
						document.getElementById($(this)[0].id.replace("time","date")).value = y1 + "-" + m1 + "-" + d1;
						$(this)[0].value = h + ":" + m;
					}
					if(id.substr(0,4) == "name") {  //双击名字设置时间(暂时不打)
						var selectValue = document.getElementById("EquipValue" + id.substr(4)).value;
						if(selectValue.length == 0) {
							document.getElementById($(this)[0].id.replace("name","date")).value = "2099-12-31";
							document.getElementById($(this)[0].id.replace("name","time")).value = "23:59";
						}
						else {
							if(selectValue.substr(0,1) == "1" || selectValue.substr(0,1) == "2") {
								document.getElementById($(this)[0].id.replace("name","date")).value = "2099-12-31";
								document.getElementById($(this)[0].id.replace("name","time")).value = "23:56";
							}
							else {
								document.getElementById($(this)[0].id.replace("name","date")).value = "2099-12-31";
								document.getElementById($(this)[0].id.replace("name","time")).value = "23:57";
							}
						}
					}
					e.preventDefault();
				});
				$("input[type='text']").mousedown(function (event) {
					var id = $(this)[0].id;
					var ww = $(this)[0].clientWidth;
					if(id.substr(0,4) == "name") {
						SelectIndex = id.substr(4);
						//有内容直接复制
						copyName($(this)[0].value);
					}
				});
				$("input[type='text']").mouseover(function (event) {
					var id = $(this)[0].id;
					if(id.substr(0,4) == "name") {
						var name = document.getElementById("name" + id.substr(4)).value;
						if(name.indexOf("(") > -1)
							name = name.substr(0,name.indexOf("("));
						if(name.indexOf("（") > -1)
							name = name.substr(0,name.indexOf("（"));
						var KillInfo = document.getElementById("KillInfo").value;	//姓名,击败,击杀,击杀出装;
						var killinfoS = KillInfo.split(";");
						var findNPC = 0;
						var row = 1;
						while(row <= killinfoS.length) {
							var s = killinfoS[row-1].split(",");
							if(s[0] == name) {
								findNPC = 1;
								var rate1 = (parseFloat(s[1])/(parseFloat(s[1])+parseFloat(s[2])+parseFloat(s[3]))*100).toFixed(2) + "%";
								var rate2 = (parseFloat(s[2])/(parseFloat(s[1])+parseFloat(s[2])+parseFloat(s[3]))*100).toFixed(2) + "%";
								var rate3 = (parseFloat(s[3])/(parseFloat(s[1])+parseFloat(s[2])+parseFloat(s[3]))*100).toFixed(2) + "%";
								$(this)[0].title = "攻击 " + (parseInt(s[1])+parseInt(s[2])+parseInt(s[3])) + " 次\r\n击败概率：" + rate1 + "\r\n击杀概率：" + rate2 + "\r\n击杀出装概率：" + rate3;
							}
							row += 1;
						}
						if(!findNPC) {
							$(this)[0].title = "";
						}
					}
				});
				$("input[type='text']").keydown(function (event) {
					var id = $(this)[0].id;
					if(id.substr(0,4) == "time" && event.keyCode == 13) {
						if(GetOS() == "windows") Sort();
					}
					if(id.substr(0,4) == "name" && event.keyCode == 13) {
						//if(GetOS() == "android") {
							ShowProgressBar();
							var selectValue = document.getElementById("EquipValue" + id.substr(4)).value;
							if(selectValue.length == 0) selectValue = "0";
							let SelectData = {};
							var selectDataS = selectValue.split(",");
							for(var i=0; i<selectDataS.length; i++){
								SelectData[i] = {"colId":selectDataS[i], "colValue":""};
							}
							$("#Equip00").multiselectInit({
								"selectData": InitEquip,
								"isSelectData": SelectData,
								"isMulti": true, //是否多选
								"inputId": "EquipValue00", //输入框的id
								"checkStyle": "fg" //选择的样式
							});
							
							$("#Equip00 div li .iconfont").each(function(){  //弹框样式--加大
								$(this)[0].style.fontSize = "48px";
								$(this)[0].style.marginLeft = "20px";
								$(this)[0].style.lineHeight = "80px";
							});
							$("#Equip00 .selectList").each(function(){  //弹框样式--换行
								$(this)[0].style.overflow = "visible";
							});
						//}
					}
				});
				
				document.getElementById("tableSort").style.fontSize="200%";
				var btns = document.getElementsByTagName('button');
				for(n=0; n<btns.length; n++) {
					btns[n].style.fontSize="150%";
					btns[n].style.height="80px";
					btns[n].onmouseover = function() {
						this.style.fontSize="180%";
					}
					btns[n].onmouseout = function() {
						this.style.fontSize="150%";
					}
				}
				document.getElementById("blankDiv").style.height = "360px";
				document.getElementById("ckCurrTime").style.width="80px";
				document.getElementById("ckCurrTime").style.height="40px";
				document.getElementById("ckTime").style.width="80px";
				document.getElementById("ckTime").style.height="40px";
				document.getElementById("ckMessage").style.width="80px";
				document.getElementById("ckMessage").style.height="40px";
				document.getElementById("ckChangePlayer").style.width="80px";
				document.getElementById("ckChangePlayer").style.height="40px";
			}
			
			async function copyName(name) {
				try {
					if(name.length > 0) {
						if(name.indexOf("(") > -1)
							name = name.substr(0,name.indexOf("("));
						if(name.indexOf("（") > -1)
							name = name.substr(0,name.indexOf("（"));
						await navigator.clipboard.writeText(name);
					}
				} catch (err) {
					alert('Failed to copy.');
				}
			}
			//设置背景色
			function SetBackColor(colorIndex) {
				if (colorIndex == 1)
					document.getElementById("name" + SelectIndex).style.background = "gray";
				else if (colorIndex == 2)
					document.getElementById("name" + SelectIndex).style.background = "pink";
				else if (colorIndex == 3)
					document.getElementById("name" + SelectIndex).style.background = "yellow";
				else if (colorIndex == 4)
					document.getElementById("name" + SelectIndex).style.background = "orange";
				else if (colorIndex == 5)
					document.getElementById("name" + SelectIndex).style.background = "red";
				else if (colorIndex == 6)
					document.getElementById("name" + SelectIndex).style.background = "-webkit-linear-gradient(left top,red,pink)";  //"#ff4500";
				else
					document.getElementById("name" + SelectIndex).style.background = "white";
			}
			//获取位置
			function getPos(ipt) {
				var p = {x: 0, y: 0};
				p.x += ipt.clientX;
				p.y += ipt.clientY;
				return p;
			}
			//操作时间
			function SetTime(way) {
				var span = 0;
				if(way=="1") span = 60;
				if(way=="2") span = 60;
				if(way=="3") span = 30;
				if(way=="4") span = 1;
				if(way=="11") span = -60;
				if(way=="22") span = -60;
				if(way=="33") span = -30;
				if(way=="44") span = -1;
				var d = document.getElementById("date" + SelectIndex).value.split("-");
				var mh = document.getElementById("time" + SelectIndex).value.split(":");
				if(document.getElementById("ckCurrTime").checked) { //自动设置当前时间 2023-02-01
					var dt0 = new Date();
					var y0 = dt0.getFullYear();
					var m0 = dt0.getMonth() + 1;
					m0 = m0 > 9 ? m0 : ("0" + m0);
					var d0 = dt0.getDate();
					d0 = d0 > 9 ? d0 : ("0" + d0);
					var hh0 = dt0.getHours();
					hh0 = hh0 > 9 ? hh0 : ("0" + hh0);
					var mm0 = dt0.getMinutes();
					d = (y0 + "-" + m0 + "-" + d0).split("-");
					mh = (hh0 + ":" + mm0).split(":");
				}
				if(mh.length < 2)
					return;
				var mm = mh[0];
				var hh = mh[1];
				var t = new Date(d[0], d[1]-1, d[2], mm, hh, "00");
				t.setTime(t.setMinutes(t.getMinutes() + span));
				var y1 = t.getFullYear();
				var m1 = t.getMonth() + 1;
				m1 = m1 > 9 ? m1 : ("0" + m1);
				var d1 = t.getDate();
				d1 = d1 > 9 ? d1 : ("0" + d1);
				var h = t.getHours();
				h = h > 9 ? h : ("0" + h);
				var m = t.getMinutes();
				m = m > 9 ? m : ("0" + m);
				document.getElementById("date" + SelectIndex).value = y1 + "-" + m1 + "-" + d1;
				document.getElementById("time" + SelectIndex).value = h + ":" + m;
				if(Math.abs(span) > 10) {  //设置隔壁时间
					var t2 = new Date(d[0], d[1]-1, d[2], mm, hh, "00");
					t2.setTime(t2.setMinutes(t2.getMinutes() + Math.floor(Math.random()*(10-5+1)+5)));  //延迟5-10分钟
					var y12 = t2.getFullYear();
					var m12 = t2.getMonth() + 1;
					m12 = m12 > 9 ? m12 : ("0" + m12);
					var d12 = t2.getDate();
					d12 = d12 > 9 ? d12 : ("0" + d12);
					var h2 = t2.getHours();
					h2 = h2 > 9 ? h2 : ("0" + h2);
					var m2 = t2.getMinutes();
					m2 = m2 > 9 ? m2 : ("0" + m2);
					var row2;
					if(SelectIndex.length == 3) row2 = SelectIndex.substr(1,2);
					else row2 = '2' + SelectIndex;
					var md2 = document.getElementById("date" + row2);
					var mh2 = document.getElementById("time" + row2);
					if (mh2.value.length > 1 && ((md2.value + " " + mh2.value) < (y12 + "-" + m12 + "-" + d12 + " " + h2 + ":" + m2))) {
						md2.value = y12 + "-" + m12 + "-" + d12;
						mh2.value = h2 + ":" + m2;
					}
				}
				//未打的+3分钟
				if(way == "1" || way == "2") {
					for(var ii=1; ii<=TotalCount-2; ii++) {
						var row1 = (ii > 9 ? ii : ("0" + ii));
						if(SelectIndex.length == 3) row1 = '2' + row1;
						if(row1 != SelectIndex) {
							var md1 = document.getElementById("date" + row1);
							var mh1 = document.getElementById("time" + row1);
							var dt1 = new Date();
							dt1.setTime(dt1.setMinutes(dt1.getMinutes() + (Math.random()*3+3)));
							var y1 = dt1.getFullYear();
							var m1 = dt1.getMonth() + 1;
							m1 = m1 > 9 ? m1 : ("0" + m1);
							var d1 = dt1.getDate();
							d1 = d1 > 9 ? d1 : ("0" + d1);
							var hh = dt1.getHours();
							hh = hh > 9 ? hh : ("0" + hh);
							var mm = dt1.getMinutes();
							mm = mm > 9 ? mm : ("0" + mm);
							if (mh1.value.length > 1 && ((md1.value + " " + mh1.value) < (y1 + "-" + m1 + "-" + d1 + " " + hh + ":" + mm))) {
								md1.value = y1 + "-" + m1 + "-" + d1;
								mh1.value = hh + ":" + mm;
							}
						}
					}
				}
				//记录击败击杀出装信息
				var name = document.getElementById("name" + SelectIndex.substr(-2,2)).value;  //取SelectIndex后两位，保证两个角色的信息都能记录
				if(name.indexOf("(") > -1)
					name = name.substr(0,name.indexOf("("));
				if(name.indexOf("（") > -1)
					name = name.substr(0,name.indexOf("（"));
				var KillInfo = document.getElementById("KillInfo").value;	//姓名,击败,击杀,击杀出装;
				var killinfoS = KillInfo.split(";");
				var findNPC = 0;
				var row = 1;
				while(row <= killinfoS.length) {
					var s = killinfoS[row-1].split(",");
					if(s[0] == name) {
						findNPC = 1;
						if(way == "1") s[3] = parseInt(s[3]) + 1;
						if(way == "2") s[2] = parseInt(s[2]) + 1;
						if(way == "3") s[1] = parseInt(s[1]) + 1;
						if(way == "11") {
							s[3] = parseInt(s[3]) - 1;
							if(s[3]<0) s[3] = 0;
						}
						if(way == "22") {
							s[2] = parseInt(s[2]) - 1;
							if(s[2]<0) s[2] = 0;
						}
						if(way == "33") {
							s[1] = parseInt(s[1]) - 1;
							if(s[1]<0) s[1] = 0;
						}
						killinfoS[row-1] = name + "," + s[1] + "," + s[2] + "," + s[3];
					}
					row += 1;
				}
				if(!findNPC) {
					if(way == "1") killinfoS.push(name + ",0,0,1");
					if(way == "2") killinfoS.push(name + ",0,1,0");
					if(way == "3") killinfoS.push(name + ",1,0,0");
				}
				KillInfo = "";
				for(var i=0; i<killinfoS.length; i++) {
					if(killinfoS[i].length > 0)
						KillInfo = KillInfo + killinfoS[i] + ";";
				}
				document.getElementById("KillInfo").value = KillInfo;
				localStorage.setItem("KillInfo", KillInfo);

				Save();
			}
			//格式化、前加“0”
			function formatTime(time) {
				if(time == "") return "";
				var timeS = time.split(":");
				return (timeS[0].length==1 ? "0"+timeS[0] : timeS[0]) + ":" + (timeS[1].length==1 ? "0"+timeS[1] : timeS[1]);
			}
			//保存
			function Save() {
				var Info = "";
				for(var row = 1; row <= TotalRowCount; row++) {
					var name = document.getElementById("name" + (row > 9 ? row : ("0" + row))).value;
					var color = document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.background;
					var date = document.getElementById("date" + (row > 9 ? row : ("0" + row))).value;
					var time = document.getElementById("time" + (row > 9 ? row : ("0" + row))).value;
					var time2 = document.getElementById("time2" + (row > 9 ? row : ("0" + row))).value;
					var selectValue = document.getElementById("EquipValue" + (row > 9 ? row : ("0" + row))).value;
					if(selectValue.length == 0) selectValue = "0";
					if(name.length > 0 && time.length > 0)
						Info = Info + ";" + name + " " + date + " " + formatTime(time) + " " + color.replaceAll(" ", "") + " " + selectValue + " " + time2;
				}
				localStorage.setItem("Info", Info.substr(1));
				if(Info.length == 0)
					window.clearInterval(MessageTimer);
			}
			//排序
			function Sort() {
				//排序
				var Info = new Array();
				
				var KillInfo = document.getElementById("KillInfo").value;	//姓名,击败,击杀,击杀出装;
				var killinfoS = KillInfo.split(";");
				
				var index = 0;
				for(var row = 1; row <= TotalRowCount; row++) {
					var name = document.getElementById("name" + (row > 9 ? row : ("0" + row))).value;
					var color = document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.background;
					var date = document.getElementById("date" + (row > 9 ? row : ("0" + row))).value;
					var time = document.getElementById("time" + (row > 9 ? row : ("0" + row))).value;
					var time2 = document.getElementById("time2" + (row > 9 ? row : ("0" + row))).value;
					var selectValue = document.getElementById("EquipValue" + (row > 9 ? row : ("0" + row))).value;
					var d = new Date();
					if(date.length == 0) date = d.getFullYear() + "-" + (d.getMonth()+1) + "-" + d.getDate();
					if(time.length == 0) {
						date = "2099-12-31";
						time = "23:59";
						time2 = "";
					}
					if(selectValue.length == 0) {
						selectValue = "0";
						date = "2099-12-31";
						time = "23:59";
						time2 = "";
					}
					if(selectValue.length == 1 && document.getElementById("ckTime").checked) {
						if(selectValue > 2) {
							if(selectValue == "7" || selectValue == "8") {
								date = "2099-12-31";
								time = "23:58";
								time2 = "";
							}
							else {
								date = "2099-12-31";
								time = "23:59";
								time2 = "";
							}
						}
					}
					if(name.length > 0) {
						var rowId = 1;
						name = name.replace("1","").replace("2","").replace("3","");
						var nameC = name;
						if(nameC.indexOf("(") > -1)
							nameC = nameC.substr(0,nameC.indexOf("("));
						if(nameC.indexOf("（") > -1)
							nameC = nameC.substr(0,nameC.indexOf("（"));
						while(rowId <= killinfoS.length) {
							var s = killinfoS[rowId-1].split(",");
							if(s[0] == nameC) {
								var rate1 = (parseFloat(s[1])/(parseFloat(s[1])+parseFloat(s[2])+parseFloat(s[3]))*100).toFixed(2);
								var rate2 = (parseFloat(s[2])/(parseFloat(s[1])+parseFloat(s[2])+parseFloat(s[3]))*100).toFixed(2);
								var rate3 = (parseFloat(s[3])/(parseFloat(s[1])+parseFloat(s[2])+parseFloat(s[3]))*100).toFixed(2);
								if(rate3 < 5)
									name = name.substr(0,name.length-1) + "3" + ")";
								else if(rate3 < 20)
									name = name.substr(0,name.length-1) + "2" + ")";
								else
									name = name.substr(0,name.length-1) + "1" + ")";
							}
							rowId += 1;
						}
					}
					
					if(name.length > 0 && time.length > 0) {
						Info[index] = new Array();
						Info[index][0]=name;
						Info[index][1]=date;
						Info[index][2]=formatTime(time);
						Info[index][3]=color.replaceAll(" ", "");
						Info[index][4]=selectValue;
						Info[index][5]=formatTime(time2);
						index = index + 1;
					}
				}

				var orderIndex = document.getElementById("orderIndex").value;
				//默认
				if(orderIndex == 0) {
					if(!document.getElementById("ckChangePlayer").checked)
						Info.sort(Sort0_1);
					else 
						Info.sort(Sort0_2);
				}
				//按姓名
				if(orderIndex == 1) {
					Info.sort(Sort1);
				}
				//按职业
				if(orderIndex == 2) {
					Info.sort(Sort2);
				}
				//按出装几率
				if(orderIndex == 3) {
					Info.sort(Sort3);
				}
				//按装备质量
				if(orderIndex == 4) {
					Info.sort(Sort4);
				}

				row = 1;
				TotalCount = Info.length + 2;
				while(row <= Info.length) {
					document.getElementById("name" + (row > 9 ? row : ("0" + row))).value = Info[row-1][0];
					document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.background = Info[row-1][3];
					document.getElementById("date" + (row > 9 ? row : ("0" + row))).value = Info[row-1][1];
					document.getElementById("time" + (row > 9 ? row : ("0" + row))).value = Info[row-1][2];
					document.getElementById("date2" + (row > 9 ? row : ("0" + row))).value = Info[row-1][1];
					document.getElementById("time2" + (row > 9 ? row : ("0" + row))).value = Info[row-1][5];
					document.getElementById("Equip" + (row > 9 ? row : ("0" + row))).style.display = "";
					var selectDataS = Info[row-1][4].split(",");
					var id = "Equip" + (row > 9 ? row : ("0" + row));
					let SelectData = {};
					for(var i=0; i<selectDataS.length; i++){
						SelectData[i] = {"colId":selectDataS[i], "colValue":""};
					}
					$("#" + id).multiselectInit({
						"selectData": InitEquip,
						"isSelectData": SelectData,
						"isMulti": true, //是否多选
						"inputId": "EquipValue" + (row > 9 ? row : ("0" + row)), //输入框的id
						"checkStyle": "fg" //选择的样式
					});
					SetColorState(row > 9 ? row : ("0" + row));
					row += 1;
				}
				while(row <= TotalRowCount) {
					document.getElementById("name" + (row > 9 ? row : ("0" + row))).value = "";
					document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.background = "white";
					document.getElementById("date" + (row > 9 ? row : ("0" + row))).value = "";
					document.getElementById("time" + (row > 9 ? row : ("0" + row))).value = "";
					document.getElementById("date2" + (row > 9 ? row : ("0" + row))).value = "";
					document.getElementById("time2" + (row > 9 ? row : ("0" + row))).value = "";
					document.getElementById("Equip" + (row > 9 ? row : ("0" + row))).style.display = "none";
					document.getElementById("EquipValue" + (row > 9 ? row : ("0" + row))).value = "";  //清空、否则新建的时候会错误用到
					row += 1;
				}
				for(var ii = 0; ii<TotalCount; ii++) {
					rowOutIn(ii, "open");
				}
				for(var ii = TotalCount; ii<=TotalRowCount; ii++) {
					rowOutIn(ii, "close");
				}
				//保存
				Save();
			}
			//默认排序
			function Sort0_1(x,y) {
				var tt = GetTopNPC(x,y);
				if(tt < 2)
					return tt;
				else
					return compare(x[1]+" "+x[2] + ColorNum(x[3]) + GetRate(x[0]), y[1]+" "+y[2] + ColorNum(y[3]) + GetRate(y[0]));
			}
			function Sort0_2(x,y) {
				var tt = GetTopNPC(x,y);
				if(tt < 2)
					return tt;
				else
					return compare(x[1]+" "+x[5] + ColorNum(x[3]) + GetRate(x[0]), y[1]+" "+y[5] + ColorNum(y[3]) + GetRate(y[0]));
			}
			//按姓名排序
			function Sort1(x,y) {
				var tt = GetTopNPC(x,y);
				if(tt < 2)
					return tt;
				else
					return compare(x[0].substr(0,x[0].indexOf('(')), y[0].substr(0,y[0].indexOf('(')));
			}
			//按职业排序
			function Sort2(x,y) {
				var tt = GetTopNPC(x,y);
				if(tt < 2)
					return tt;
				else
					return compare(x[0].substr(x[0].indexOf('(')+1,1)+GetRate(x[0]), y[0].substr(y[0].indexOf('(')+1,1)+GetRate(y[0]));
			}
			//按出装几率排序
			function Sort3(x,y) {
				var tt = GetTopNPC(x,y);
				if(tt < 2)
					return tt;
				else {
					var KillInfo = document.getElementById("KillInfo").value;	//姓名,击败,击杀,击杀出装;
					var killinfoS = KillInfo.split(";");
					var rate1 = 0.00, rate2 = 0.00;
					var row = 1;
					while(row <= killinfoS.length) {
						var s = killinfoS[row-1].split(",");
						if(s[0] == x[0].substr(0,x[0].indexOf('('))) {
							rate1 = (parseFloat(s[3])/(parseFloat(s[1])+parseFloat(s[2])+parseFloat(s[3]))*100).toFixed(2);
						}
						if(s[0] == y[0].substr(0,y[0].indexOf('('))) {
							rate2 = (parseFloat(s[3])/(parseFloat(s[1])+parseFloat(s[2])+parseFloat(s[3]))*100).toFixed(2);
						}
						if(x[1]+" "+x[2] == "2099-12-31 23:56") rate1 = -1;
						if(x[1]+" "+x[2] == "2099-12-31 23:57") rate1 = -2;
						if(x[1]+" "+x[2] == "2099-12-31 23:58") rate1 = -3;
						if(x[1]+" "+x[2] == "2099-12-31 23:59") rate1 = -4;
						if(y[1]+" "+y[2] == "2099-12-31 23:56") rate2 = -1;
						if(y[1]+" "+y[2] == "2099-12-31 23:57") rate2 = -2;
						if(y[1]+" "+y[2] == "2099-12-31 23:58") rate2 = -3;
						if(y[1]+" "+y[2] == "2099-12-31 23:59") rate2 = -4;
						row += 1;
					}
					if(Number(rate1) > Number(rate2)) return -1;
					else return 1;
				}
			}
			//按装备质量排序
			function Sort4(x,y) {
				var tt = GetTopNPC(x,y);
				if(tt < 2)
					return tt;
				else {
					var color1, color2;
					if(x[3] == "-webkit-linear-gradient(lefttop,red,pink)") color1 = 6;
					if(x[3] == "red") color1 = 5;
					if(x[3] == "orange") color1 = 4;
					if(x[3] == "yellow") color1 = 3;
					if(x[3] == "pink") color1 = 2;
					if(x[3] == "gray") color1 = 1;
					if(x[3] == "white") color1 = 0;
					if(y[3] == "-webkit-linear-gradient(lefttop,red,pink)") color2 = 6;
					if(y[3] == "red") color2 = 5;
					if(y[3] == "orange") color2 = 4;
					if(y[3] == "yellow") color2 = 3;
					if(y[3] == "pink") color2 = 2;
					if(y[3] == "gray") color2 = 1;
					if(y[3] == "white") color2 = 0;
					if(x[1]+" "+x[2] == "2099-12-31 23:56") color1 = -1;
					if(x[1]+" "+x[2] == "2099-12-31 23:57") color1 = -2;
					if(x[1]+" "+x[2] == "2099-12-31 23:58") color1 = -3;
					if(x[1]+" "+x[2] == "2099-12-31 23:59") color1 = -4;
					if(y[1]+" "+y[2] == "2099-12-31 23:56") color2 = -1;
					if(y[1]+" "+y[2] == "2099-12-31 23:57") color2 = -2;
					if(y[1]+" "+y[2] == "2099-12-31 23:58") color2 = -3;
					if(y[1]+" "+y[2] == "2099-12-31 23:59") color2 = -4;
					return compare(color2, color1);
				}
			}
			//排序第二条件
			function ColorNum(color) {
				if(color == "-webkit-linear-gradient(lefttop,red,pink)") return 0;
				if(color == "red") return 1;
				if(color == "orange") return 2;
				if(color == "yellow") return 3;
				if(color == "pink") return 4;
				if(color == "gray") return 5;
				if(color == "white") return 6;
				return -1;
			}
			//排序第三条件
			function GetRate(name) {
				var KillInfo = document.getElementById("KillInfo").value;	//姓名,击败,击杀,击杀出装;
				var killinfoS = KillInfo.split(";");
				var rate = 0.00;
				var row = 1;
				while(row <= killinfoS.length) {
					var s = killinfoS[row-1].split(",");
					if(s[0] == name.substr(0,name.indexOf('('))) {
						rate = (parseFloat(s[3])/(parseFloat(s[1])+parseFloat(s[2])+parseFloat(s[3]))*100).toFixed(2);
					}
					row += 1;
				}
				var rateS = Number(100.00-rate).toFixed(2).split(".");
				return (rateS[0] == 100 ? rateS[0] : (rateS[0] > 9 ? ("0" + rateS[0]) : ("00" + rateS[0]))) + "." + rateS[1];
			}
			//比较时间
			function compare(date1, date2) {
				if(date1 >= date2) return 1;
				else return -1;
			}
			let TopNPC = [];
			//置顶
			function SetTopNPC() {
				var name = document.getElementById("name" + SelectIndex).value;
				if(name.indexOf("(") > -1)
					name = name.substr(0,name.indexOf("("));
				if(name.indexOf("（") > -1)
					name = name.substr(0,name.indexOf("（"));
				var index = TopNPC.indexOf(name);
				if(index > -1) {
					TopNPC.splice(index, 1);
				}
				else {
					TopNPC.push(name);
				}
				if(TopNPC.length > 0)
					alert("当前置顶 NPC：" + TopNPC.join('、'));
			}
			//置顶操作
			function GetTopNPC(x,y) {
				var xx, yy;
				if(x[0].indexOf("(") > -1)
					xx = x[0].substr(0,x[0].indexOf("("));
				else
					xx = x[0];
				if(y[0].indexOf("(") > -1)
					yy = y[0].substr(0,y[0].indexOf("("));
				else
					yy = y[0];
				if(TopNPC.indexOf(xx)>-1 && TopNPC.indexOf(yy)==-1)
					return -1;
				if(TopNPC.indexOf(xx)==-1 && TopNPC.indexOf(yy)>-1)
					return 1;
				if(TopNPC.indexOf(xx)>-1 && TopNPC.indexOf(yy)>-1)
					return 0;
				return 2;
			}
			//发送通知
			function notifyMe() {
				var d = new Date();
				var y1 = d.getFullYear();
				var m1 = d.getMonth() + 1;
				m1 = m1 > 9 ? m1 : ("0" + m1);
				var d1 = d.getDate();
				d1 = d1 > 9 ? d1 : ("0" + d1);
				var hh = d.getHours();
				hh = hh > 9 ? hh : ("0" + hh);
				var mm = d.getMinutes();
				mm = mm > 9 ? mm : ("0" + mm);
				var currentDate = y1 + "-" + m1 + "-" + d1 + " " + hh + ":" + mm;
				var Info = localStorage.getItem("Info");
				if(Info == null || Info == "") { }
				else {
					var infoS = Info.split(";");
					var row = 1;
					while(row <= infoS.length) {
						var s = infoS[row-1].split(" ");
						if(s[1]+" "+s[2] <= currentDate && document.getElementById("ckMessage").checked) {
							if(GetOS() == "windows")
								ShowMsg("可以攻击 " + s[0] + " 了!");
							else
								$.NZ_MsgBox.tipsbar({ title: "通知", content: "<font size='3'>可以攻击 <font size='5' color='#330099'><strong>" + s[0] + "</strong></font> 了!</font>", type: "info", tipsort: "bottom", showtime: 3000 });
						}
						row++;
					}
				}
			}
			//改变颜色
			function colorMe() {
				var d = new Date();
				var y1 = d.getFullYear();
				var m1 = d.getMonth() + 1;
				m1 = m1 > 9 ? m1 : ("0" + m1);
				var d1 = d.getDate();
				d1 = d1 > 9 ? d1 : ("0" + d1);
				var hh = d.getHours();
				hh = hh > 9 ? hh : ("0" + hh);
				var mm = d.getMinutes();
				mm = mm > 9 ? mm : ("0" + mm);
				var currentDate = y1 + "-" + m1 + "-" + d1 + " " + hh + ":" + mm;
				var Info = localStorage.getItem("Info");
				if(Info == null || Info == "") { }
				else {
					var infoS = Info.split(";");
					var row = 1;
					while(row <= infoS.length) {
						var s = infoS[row-1].split(" ");
						if(s[1]+" "+s[2] <= currentDate) {
							document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.color="green";
							document.getElementById("time" + (row > 9 ? row : ("0" + row))).style.color="green";
						}
						else {
							document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.color="";
							document.getElementById("time" + (row > 9 ? row : ("0" + row))).style.color="";
						}
						var time2 = document.getElementById("time2" + (row > 9 ? row : ("0" + row)));
						if(time2.value.length > 1 &&  time2.value <= (hh + ":" + mm))
							time2.style.color="green";
						else
							time2.style.color="";
						row++;
					}
				}
				//定时开关消息提示
				if(GetOS() == "windows") {
					var ckMessage = document.getElementById("ckMessage");
					currentDate = currentDate.split(" ")[1];
					if(compare(currentDate, "09:00") > 0 && compare(currentDate, "09:05") < 0 && !ckMessage.checked) {
						ckMessage.checked = true;
						ckMessage.title = "消息提示已开启";
					}
					if(compare(currentDate, "17:45") > 0 && compare(currentDate, "17:50") < 0 && ckMessage.checked) {
						ckMessage.checked = false;
						ckMessage.title = "消息提示已关闭";
					}
				}
			}
			//显示消息
			function ShowMsg(msg) {
				//浏览器是否支持
				if(!("Notification" in window)) {
					window.clearInterval(MessageTimer);
					alert("This browser does not support desktop notification.");
				}
				//检查用户是否同意接受通知
				else if (Notification.permission === "granted") {
					sendNotice(msg);
				}
				//否则我们需要向用户获取权限
				else if (Notification.permission !== "denied") {
					Notification.requestPermission(function(permission) {
						if (permission === "granted") {
							sendNotice(msg);
						}
					});
				}
			}
			
			function sendNotice(msg) {
				var notification = new Notification("提示", {
						body: msg,
						icon: "https://github.com/moseslinLin/NPC.github.io/blob/main/icon.jpg"
					});
				notification.onclick = function() {
					var name = notification.body.replace("可以攻击 ", "").replace(" 了!", "");
					/* copyName(name);  //DOMException: Document is not focused. */
					var clipboard = document.createElement('textarea');
					if(name.indexOf("(") > -1)
						name = name.substr(0,name.indexOf("("));
					if(name.indexOf("（") > -1)
						name = name.substr(0,name.indexOf("（"));
					clipboard.value = name;
					document.body.appendChild(clipboard);
					clipboard.select();
					document.execCommand('Copy');
					document.body.removeChild(clipboard);
					notification.close();
				};
				setTimeout(function () {
					notification.close();  //关闭桌面通知  
				}, 3000);
			}
			
			const clipboardObj = navigator.clipboard;
			
			async function Copy1() {  //复制NPC
				var Info = "";
				for(var row = 1; row <= TotalRowCount; row++) {
					var name = document.getElementById("name" + (row > 9 ? row : ("0" + row))).value;
					//var color = document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.background;
					var date = document.getElementById("date" + (row > 9 ? row : ("0" + row))).value;
					var time = document.getElementById("time" + (row > 9 ? row : ("0" + row))).value;
					var time2 = document.getElementById("time2" + (row > 9 ? row : ("0" + row))).value;
					var selectValue = document.getElementById("EquipValue" + (row > 9 ? row : ("0" + row))).value;
					if(selectValue.length == 0) selectValue = "0";
					if(name.length > 0 && time.length > 0)
						Info = Info + ";" + name + " " + date + " " + formatTime(time) + " " + selectValue + " " + time2;
				}
				try {
					await navigator.clipboard.writeText(Info.substr(1));
					if(GetOS() == "windows")
						location = "mailto:moseslin@163.com?subject=NPC&body=";  // + Info.substr(1)
					else
						location = "mailto:itan@ceccoils.com?subject=NPC&body=";
				} catch (err) {
					alert('Failed to copy.');
				}
			}
			
			async function Copy2() {  //复制参数
				var Info = "";
				//复制时加上上一次击杀NPC爆出倍卡的时间
				//本地直接打开文件的情况下，需要给浏览器EXE文件添加启动参数--enable-file-cookies，如有多个参数用空格隔开
				//"C:\Program Files\Google\Chrome\Application\chrome.exe" --enable-file-cookies --allow-file-access-from-files
				if(parent.document.getElementById("AllTime1") != null) {
					Info = parent.document.getElementById("AllTime1").value + "|" + parent.document.getElementById("AllTime2").value + "|" + parent.document.getElementById("AllTime3").value;
				}
				Info = Info + "|" + document.getElementById("KillInfo").value;
				try {
					await navigator.clipboard.writeText(Info);
					if(GetOS() == "windows")
						location = "mailto:moseslin@163.com?subject=NPC&body=";  // + Info
					else
						location = "mailto:itan@ceccoils.com?subject=NPC&body=";
				} catch (err) {
					alert('Failed to copy.');
				}
			}	
			
			async function Paste1() {  //粘贴NPC
				try {
					const Info = await navigator.clipboard.readText();
					if(confirm("确认粘贴NPC？")) {
						if(Info == null || Info == "") { }
						else {
							var infoS = Info.split(";");
							var row = 1;
							while(row <= infoS.length) {
								var s = infoS[row-1].split(" ");
								document.getElementById("name" + (row > 9 ? row : ("0" + row))).value = s[0];
								//document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.background = s[3];
								document.getElementById("date" + (row > 9 ? row : ("0" + row))).value = s[1];
								document.getElementById("time" + (row > 9 ? row : ("0" + row))).value = s[2];
								document.getElementById("date2" + (row > 9 ? row : ("0" + row))).value = s[1];
								document.getElementById("time2" + (row > 9 ? row : ("0" + row))).value = s[4];
								document.getElementById("Equip" + (row > 9 ? row : ("0" + row))).style.display = "";
								var selectDataS = s[3].split(",");
								var id = "Equip" + (row > 9 ? row : ("0" + row));
								let SelectData = {};
								for(var i=0; i<selectDataS.length; i++){
									SelectData[i] = {"colId":selectDataS[i], "colValue":""};
								}
								$("#" + id).multiselectInit({
									"selectData": InitEquip,
									"isSelectData": SelectData,
									"isMulti": true, //是否多选
									"inputId": "EquipValue" + (row > 9 ? row : ("0" + row)), //输入框的id
									"checkStyle": "fg" //选择的样式
								});
								SetColorState(row > 9 ? row : ("0" + row));
								row++;
							}
							while(row <= TotalRowCount) {
								document.getElementById("name" + (row > 9 ? row : ("0" + row))).value = "";
								document.getElementById("name" + (row > 9 ? row : ("0" + row))).style.background = "white";
								document.getElementById("time" + (row > 9 ? row : ("0" + row))).value = "";
								document.getElementById("time2" + (row > 9 ? row : ("0" + row))).value = "";
								document.getElementById("Equip" + (row > 9 ? row : ("0" + row))).style.display = "none";
								document.getElementById("EquipValue" + (row > 9 ? row : ("0" + row))).value = "";  //清空、否则新建的时候会错误用到
								row += 1;
							}
						}
					}
				} catch (err) {
					alert('Failed to paste.');
				}
			}
			
			async function Paste2() {  //粘贴参数
				try {
					const Info = await navigator.clipboard.readText();
					if(confirm("确认粘贴参数？")) {
						if(Info == null || Info == "") { }
						else {
							//上一次击杀NPC爆出倍卡的时间
							var infoS = Info.split("|");
							if(infoS.length == 4) {
								if(infoS[0].length > 0) {
									try {
										parent.document.getElementById("AllTime1").value = infoS[0];
										var infoS2 = infoS[0].split(";");
										var infoS3 = infoS2[infoS2.length-2].split(" ");
										parent.document.getElementById("date1").value = infoS3[0];
										parent.document.getElementById("time1").value = infoS3[1];
										parent.SetTime(4);
									} catch (err2) { }
								}
								if(infoS[1].length > 0) {
									try {
										parent.document.getElementById("AllTime2").value = infoS[1];
										var infoS2 = infoS[1].split(";");
										var infoS3 = infoS2[infoS2.length-2].split(" ");
										parent.document.getElementById("date2").value = infoS3[0];
										parent.document.getElementById("time2").value = infoS3[1];
										parent.SetTime(5);
									} catch (err2) { }
								}
								if(infoS[2].length > 0) {
									try {
										parent.document.getElementById("AllTime3").value = infoS[2];
										var infoS2 = infoS[2].split(";");
										var infoS3 = infoS2[infoS2.length-2].split(" ");
										parent.document.getElementById("date3").value = infoS3[0];
										parent.document.getElementById("time3").value = infoS3[1];
										parent.SetTime(6);
									} catch (err2) { }
								}
								document.getElementById("KillInfo").value = infoS[3];
								localStorage.setItem("KillInfo", infoS[3]);
							}
							else {
								document.getElementById("KillInfo").value = infoS[1];
								localStorage.setItem("KillInfo", infoS[1]);
							}
						}
					}
				} catch (err) {
					alert('Failed to paste.');
				}
			}
			//隐藏 table 的某一行
			function rowOutIn(i, type) {
				var _tableSort = document.getElementById("tableSort");
				try {
					if(type != "open") {
						//e.style.display = "none";
						_tableSort.rows[i].style.display = "none";
					}
					else {
						//e.style.display = "table-row";
						_tableSort.rows[i].style.display = "table-row";
					}
				}
				catch(err) { }
			}
			
			function GetOS() {
				var agent = navigator.userAgent.toLowerCase();
				var ios = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
				var mac = /macintosh|mac os x/i.test(navigator.userAgent) && !window.MSStream;
				var android = /Android/.test(navigator.userAgent) && !window.MSStream;

				if (agent.indexOf("win32") >= 0 || agent.indexOf("wow32") >= 0) return "windows";
				if (agent.indexOf("win64") >= 0 || agent.indexOf("wow64") >= 0) return "windows";
				if (ios) return "iphone";
				if (mac) return "mac";
				if (android) return "android";
				return "unknow";
			}
			//设置背景色
			function SetColorState(colorIndex) {
				SelectIndex = colorIndex;
				var selectData = document.getElementById("EquipValue" + colorIndex).value;
				if(selectData.length > 0) {
					var selectDataS = selectData.split(",");
					if(selectData.substr(0, 1) == "1") {
						if (selectDataS.length >= 4) SetBackColor(6);
						else SetBackColor(5);
					}
					else if (selectData.substr(0, 1) == "2") {
						if (selectDataS.length >= 4) SetBackColor(5);
						else SetBackColor(4);
					}
					else if (selectDataS.length == 6) SetBackColor(4);
					else if (selectDataS.length >= 4) SetBackColor(3);
					else if (selectDataS.length >= 2) SetBackColor(2);
					else if (selectDataS.length == 1) SetBackColor(1);
					else SetBackColor(0);
				}
				else SetBackColor(0);
			}
			//设置提示
			function ShowTitle(obj) {
				if(obj.checked)
					obj.title = "消息提示已开启";
				else
					obj.title = "消息提示已关闭";
			}
			
			function ShowTime(obj) {
				if(obj.checked)
					obj.title = "自动调整时间已开启";
				else
					obj.title = "自动调整时间已关闭";
			}
			
			function ShowCurrentTime(obj) {
				if(obj.checked)
					obj.title = "自动当前时间已开启";
				else
					obj.title = "自动当前时间已关闭";
			}
			
			function ChangePlayer(obj) {
				if(obj.checked)
					obj.title = "当前角色：老魔";
				else
					obj.title = "当前角色：制杖老魔";
			}
			//合并
			function MergeNPC() {
				var NewKillInfo=prompt("请输入击杀情况：", "");
				if(NewKillInfo!=null && NewKillInfo!=""){
					var newKillInfoS = NewKillInfo.split(";");
					var KillInfo = document.getElementById("KillInfo").value;
					var killinfoS = KillInfo.split(";");
					var findNPC = 0;
					var row1 = 0, row2 = 0;
					while(row1 < newKillInfoS.length) {
						if(newKillInfoS[row1].length > 0) {
							findNPC = 0, row2 = 0;
							var s1 = newKillInfoS[row1].split(",");
							while(row2 < killinfoS.length) {
								if(killinfoS[row2].length > 0) {
									var s2 = killinfoS[row2].split(",");
									if(s1[0] == s2[0]) {
										findNPC = 1;
										s2[1]=Number(s2[1])+Number(s1[1]);
										s2[2]=Number(s2[2])+Number(s1[2]);
										s2[3]=Number(s2[3])+Number(s1[3]);
										killinfoS[row2] = s2[0] + "," + s2[1] + "," + s2[2] + "," + s2[3];
									}
								}
								row2 += 1;
							}
							if(findNPC == 0) {
								killinfoS.push(s1[0] + "," + s1[1] + "," + s1[2] + "," + s1[3]);
							}
						}
						row1 += 1;
					}
					KillInfo = "";
					for(var i=0; i<killinfoS.length; i++) {
						if(killinfoS[i].length > 0)
							KillInfo = KillInfo + killinfoS[i] + ";";
					}
					document.getElementById("KillInfo").value = KillInfo;
					localStorage.setItem("KillInfo", KillInfo);
				}
			}
		</script>
	</body>
</html>
